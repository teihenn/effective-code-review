- [コードレビューのtips, レビュイー編](#コードレビューのtips-レビュイー編)
  - [コメントを受けて修正を行ったら、その旨の返信を行い、コミットのリンクも記載しておく](#コメントを受けて修正を行ったらその旨の返信を行いコミットのリンクも記載しておく)
  - [レビュアーからのコメントは重要だが、必ずしも全てを受け入れる必要は無い](#レビュアーからのコメントは重要だが必ずしも全てを受け入れる必要は無い)
- [コードレビューのtips, レビュアー編](#コードレビューのtips-レビュアー編)
  - [迅速にフィードバックを行う](#迅速にフィードバックを行う)
    - [コードレビューの遅延がもたらす影響](#コードレビューの遅延がもたらす影響)
    - [期待されるプラクティス](#期待されるプラクティス)
  - [断片的なコメントを避ける](#断片的なコメントを避ける)
  - [コードレビューが答えるべき最も根本的な質問：自分はこれをメンテナンス出来るか？\[2\]](#コードレビューが答えるべき最も根本的な質問自分はこれをメンテナンス出来るか2)
  - [コード作者を尊重し、質問する](#コード作者を尊重し質問する)
  - [礼儀正しくする\[1\]\[2\]](#礼儀正しくする12)
  - [代案無しの指摘はしない。また、代案はなるべく具体的に提示する](#代案無しの指摘はしないまた代案はなるべく具体的に提示する)
  - [コメントにラベルを付ける\[8\]](#コメントにラベルを付ける8)
    - [ラベル例](#ラベル例)
    - [ラベルを付ける利点](#ラベルを付ける利点)
  - [自分のエディタ上で見てレビューする\[2\]\[5\]](#自分のエディタ上で見てレビューする25)
  - [良い部分は称賛し感謝を伝える](#良い部分は称賛し感謝を伝える)
- [コードレビューのtips, レビュイー \& レビュアー編](#コードレビューのtips-レビュイー--レビュアー編)
  - [PR内容に関する議論は基本的にはPR上で行う](#pr内容に関する議論は基本的にはpr上で行う)
  - [自動的な静的解析を導入しレビューの負担を軽減する\[1\]](#自動的な静的解析を導入しレビューの負担を軽減する1)

# コードレビューのtips, レビュイー編

## コメントを受けて修正を行ったら、その旨の返信を行い、コミットのリンクも記載しておく

- コメントに対する対応を行ったら、レビュアーが自発的にPRを見にいかなくてもそれを知ることが出来るように、その旨を必ず返信する
- 修正をしたコミットのリンクをコメントの返信時に一緒に記載し、どのコミットがどのコメントに対する修正なのかすぐわかるようにしてあげるとレビューがとても捗る
    - いくつものコメント対応を1つのコミットにするのではなく、話題ごとにコミットを分ける
- これが無くてコミットメッセージで「レビュー指摘対応」みたいなのがたくさんあったりすると、どのコミットがどのコメントに対するものか探すのもつらい

## レビュアーからのコメントは重要だが、必ずしも全てを受け入れる必要は無い

- 自分(レビュイー)がコメントの内容に合意できなかったり疑問がある場合は、質問や説明を行い対話をする
- ただし、コード作者はコードを自分で完成させたばかりでコンテキストを最も持っている状態のため、特にコードの読みやすさなどは評価できる立場にない。レビュアーはコード作者よりコンテキストが無い状態で読んでいるので、レビュアーの意見は軽んじてはいけない

# コードレビューのtips, レビュアー編

## 迅速にフィードバックを行う

### コードレビューの遅延がもたらす影響

| 影響の分野 | 具体的な影響 | 詳細 |
|------------|--------------|------|
| 開発プロセス | 開発速度の低下 | - 変更のマージが遅れ、開発サイクルが長期化<br>- 新機能リリースやバグ修正の遅延 |
| | コンテキストスイッチのコスト増大 | - 長期間待機中のPRへの再着手時、コンテキスト再把握に時間を要する<br>- 生産性低下や再作業の可能性 |
| | ブランチの競合リスク増加 | - 長期未マージのブランチがメインブランチと競合するリスク上昇<br>- 競合解決に追加時間とリソースが必要 |
| チームワーク | モチベーションの低下 | - フィードバック不足によるモチベーション低下<br>- チーム内コミュニケーションや協力関係への悪影響 |
| | フィードバックループの長期化 | - 早期フィードバック獲得の機会損失<br>- 同じ問題の繰り返しと学習曲線の鈍化 |
| | チーム間の連携阻害 | - 他チーム依存の変更がレビュー待ちになり連携阻害<br>- プロジェクト全体の進捗に影響 |
| コード品質 | コード品質への悪影響 | - 大量のコードを一度にレビューすることによる細部の見落とし<br>- バグの見逃しやコード品質全体の低下 |
| | 技術的負債の蓄積 | - レビュー待ち期間中の要件や設計変更による再変更の必要性<br>- マージ後すぐに修正が必要になるなどの負債蓄積 |
| | セキュリティリスクの増大 | - セキュリティ関連の修正や更新の遅延<br>- 脆弱性の長期放置リスク |
| プロジェクト管理 | プロジェクト管理の複雑化 | - 未レビューPR蓄積によるプロジェクト進捗把握の困難<br>- リソース配分や締め切り管理の複雑化 |
| ビジネス影響 | 顧客満足度への影響 | - 新機能や修正リリースの遅延による顧客満足度低下<br>- 競合他社に後れを取るリスク増大 |


### 期待されるプラクティス

- 24時間以内にファーストレビューが行えるとベスト[1]
  - 時間がかかりそうな場合は、少なくともPRを目にしてはいて出来るだけ早くレビューに着手予定であると返信するのが良い（音沙汰が無い状態が続くとレビュイーは見てもらえているのか不安になるので）
    - 早ければ早いほど良いが、集中している最中に自分の作業を中断してまで早く始める必要は基本的にはない（かえって全体効率が低下するかもしれない）[6]
- コードレビューを仕事のルーティンに組み込むのも良い[2]
    - たとえば、毎朝30分と昼食後の30分をレビューのために確保する
    - 昼食前に1時間とっても良いし、帰宅前に時間を取っても良い。ただし、なにか他のことをしている途中なのでスキップする可能性が高くなる

## 断片的なコメントを避ける

- *レビュアーは、コードレビューに少しずつ断片的に返信することも避けるべきだ。レビュープロセスでは、レビューでフィードバックを得て対処してから無関係なフィードバックをさらに受け続けることほど、コード作者にとって苛立たしいことも滅多にない*[1]
- 思いついたフィードバックを五月雨式に返す方は楽だが、場合によってはフィードバックを受ける側が精神的に疲弊してしまうケースもあり、注意が必要
- レビューツールのStart review機能を活用する
    - 複数のコメントをまとめて一度に送信することが出来る

## コードレビューが答えるべき最も根本的な質問：自分はこれをメンテナンス出来るか？[2]

- コードが読みやすいかどうかは、コードレビューの最も重要な基準と言っても過言ではない。コードは脳に収まるか？
- メソッドが長すぎたり複雑すぎたりしないのか？何をやっているのか理解しやすいのか等
- *実に意外なことに、コードの正しさのチェックは、コードレビューのプロセスからGoogleが得る恩恵の首位ではない。(〜中略〜) 時間が経ちコードベースがスケールした場合もコードの変更が理解可能で意味を成すと保証することの方が、意義が大きい。*[1]

## コード作者を尊重し、質問する

- *一般に、レビュアーはコード作者の特定アプローチについて作者を尊重すべきであり、作者のアプローチが不十分な場合にのみ代案の指摘を行うべきだ。作者が同等の妥当なアプローチをいくつか示せるなら、レビュアーはその作者の選好を受け入れるべきである。(〜中略〜)そのアプローチが間違っていると決めてかかる前に、何故そのようなアプローチが採られたかについて質問した方がよい。*[1]
- 好みの話くらいのものは押し付けないよう気を付ける

## 礼儀正しくする[1][2]

- コードレビューは非同期なプロセスであり、通常は文字でレビューすることになる。文字だとトーンや意図は簡単に失われる。悪意を与えるつもりのない言い回しでも、受け手はそれを読んで傷つくこともある。必要以上に礼儀正しくする。

## 代案無しの指摘はしない。また、代案はなるべく具体的に提示する

- 指摘だけだとレビュイーも困るかもしれないので、せめてこちらの修正イメージ伝えるとかは最低でもしたほうが良い
- 代案が曖昧だとまたそこでレビュイーが悩んでしまったりするので具体的に提示できるならそうしたほうが良い
- また、なるべく具体的に提示することで、こちらのコメントを受けてレビュイーの行ってくれた修正と自分の修正イメージが微妙に違うが再度指摘するのも憚られる、みたいな状況になるのも防ぎやすい

## コメントにラベルを付ける[8]

### ラベル例

| ラベル | 意味 | 意図 |
|--------|------|------|
| ASK | 質問 (Question) | 質問。回答が必要 |
| FYI | 参考まで (For your information) | 参考までに共有。アクションは不要 |
| NITS | あら捜し (Nitpick) | 些細な指摘。無視しても良い |
| NR | お手すきで (No rush) | 今やらなくて良いが、将来的には解決したい提案。タスク化や修正を検討 |
| IMHO | 提案 (In my humble opinion) | 個人的な意見であり、議論の余地があることを伝える |
| MUST | 必須 (Must) | 必須の修正点であり、これを直さないと承認できないことを伝える |

### ラベルを付ける利点

- すべてのコメントに対して修正が必須でなく、対等な関係性となりやすい
- するべきアクションが明確に伝わるため、認識の齟齬が起こらない
- コメント対応の優先順位が明確になる
- nitsやimhoなどのラベルにより、フィードバックが過度に批判的に受け取られるリスクを軽減
- コメントの敷居が下がることより、議論の活性化
- ラベル付きコメントを分析することでコード品質などの傾向を把握することも出来る
    - 例：askラベルの頻度が高い場合は、コメントやコミットメッセージなどで説明不足であることが多いかもしれないなど

## 自分のエディタ上で見てレビューする[2][5]

- 基本的に自分のマシンにコードをチェックアウトしてレビューすると良い
- ブラウザ上のGitHubやBitbucketで見るだけでは気づかないものに気付けることがある
  - フォーマッタがかかっていない
  - アナライザが警告を出している
  - 修正漏れ
    - 差分の周辺部分も自然と目にすることになるので、修正漏れに気付けることがある(例：マジックナンバーの定数化時にそのままの部分が残っているなど)
- 自分のマシンにコードをチェックアウトしレビューすることで、プロジェクト全体のコンテキストで修正を理解しやすくなったり、自分の修正提案の動作確認を出来たり、作者にコメントしっぱなしではないより責任持ったレビューが出来る
- Bitbucketなどブラウザ上で関数ジャンプが出来ないサービスでは、ブラウザ上だけで見るのがわりとつらかったりするのもある
- VSCodeであればGitLens拡張機能を使ってのレビューがおすすめ

## 良い部分は称賛し感謝を伝える

- *CL(Changelist) の中に素晴らしいものを見つけたら、開発者に教えてあげてください。特に、あなたのレビューコメントの一つに取り組んで素晴らしくやり遂げたらそうしてください。 コードレビューは間違いにばかり目が行きがちですが、良い実践に対しての励ましや感謝の言葉も伝えるべきです。 メンタリングの観点では、開発者が正しいこと行ったときにそれを伝えるほうが、間違いを指摘するよりもずっと価値がある場合があります。*[6]

# コードレビューのtips, レビュイー & レビュアー編

## PR内容に関する議論は基本的にはPR上で行う

- 議論の場所が散らばるのは望ましくないため、PR内で議論は行うようにするべき
- slackや口頭で行った場合は、PRにリンクを貼るなり、コメントに記載し他の人や後から見たときにも分かるようにしておく

## 自動的な静的解析を導入しレビューの負担を軽減する[1]

- 静的解析で細かい話はあらかじめ取り除いておくことでよりレビュアーが本質的なレビューに集中しやすくなる
